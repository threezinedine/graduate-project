/*
 * CommandConfig.c
 *
 *  Created on: Feb 12, 2024
 *      Author: Acer
 */

#include "CommandConfig.h"
#include "Command.h"
#include "string.h"
#include "AnalogInput.h"


void Command_DefaultResponse(uint8_t argc, char **argv)
{
	Command_ResponseConstChar("Unknown command");
}

static uint8_t GetIndexFromString(char *argv);

void Command_AnalogInputConfig(uint8_t argc, char **argv)
{
	char response[256];
	uint8_t index = 0;

	switch (argc)
	{
	case 0:
		AnalogInput_GetStatusString(response, 128);
		Command_Response(response, strlen(response));
		break;
	case 2:
		if (strcmp(argv[0], "on") == 0)
		{
			index = GetIndexFromString(argv[1]);
			if (index == -1) return;

			AnalogInput_TurnOn(index);
			Command_ResponseConstChar("Setup successfully");
		}
		else if (strcmp(argv[0], "off") == 0)
		{
			index = GetIndexFromString(argv[1]);
			if (index == -1) return;

			AnalogInput_TurnOff(index);
			Command_ResponseConstChar("Setup successfully");
		}
		else
		{
			Command_ResponseConstChar("Invalid command");
		}
		break;
	case 3:
		if (strcmp(argv[0], "type") == 0)
		{
			index = GetIndexFromString(argv[1]);
			if (index == -1) return;

			uint8_t typeVal = AnalogInput_TypeFromString(argv[2]);
			if (typeVal == -1)
			{
				Command_ResponseConstChar("Type must be in: int8, uint8, "
											"int16, uint16, "
											"int32, uint32, "
											"float32.");
				return;
			}
			AnalogInput_SetType(index, typeVal);
			Command_ResponseConstChar("Setup successfully");
		}
		else if (strcmp(argv[0], "input-max") == 0)
		{
			index = GetIndexFromString(argv[1]);
			if (index == -1) return;

			AnalogInput_SetInputMax(index, atof(argv[2]));
			Command_ResponseConstChar("Setup successfully");
		}
		else
		{
			Command_ResponseConstChar("Invalid command");
		}
		break;
	case 4:
		if (strcmp(argv[0], "minmax") == 0)
		{
			index = GetIndexFromString(argv[1]);
			if (index == -1) return;

			AnalogInput_SetMinAndMax(index, atof(argv[2]), atof(argv[3]));
			Command_ResponseConstChar("Setup successfully");
		}
		else
		{
			Command_ResponseConstChar("Invalid command");
		}
		break;
	default:
		Command_ResponseConstChar("Invalid command");
	}
}

uint8_t GetIndexFromString(char *argv)
{
	if (argv[0] > '3' || argv[0] < '0')
	{
		Command_ResponseConstChar("Index must be from 0 - 3");
		return -1;
	}
	return argv[0] - '0';
}
